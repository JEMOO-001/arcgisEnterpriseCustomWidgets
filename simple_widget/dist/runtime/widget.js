System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/layers/WMSLayer","esri/geometry/geometryEngine","esri/widgets/Swipe","esri/request","esri/layers/GroupLayer","esri/layers/GraphicsLayer","esri/Graphic"],(function(e,t){var a={},n={},l={},r={},i={},o={},s={},c={},d={},m={};return{setters:[function(e){a.React=e.React},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent},function(e){l.Button=e.Button,l.Option=e.Option,l.Select=e.Select},function(e){r.default=e.default},function(e){i.geodesicArea=e.geodesicArea,i.union=e.union},function(e){o.default=e.default},function(e){s.default=e.default},function(e){c.default=e.default},function(e){d.default=e.default},function(e){m.default=e.default}],execute:function(){e((()=>{var e={89:e=>{"use strict";e.exports=m},958:e=>{"use strict";e.exports=i},620:e=>{"use strict";e.exports=d},750:e=>{"use strict";e.exports=c},160:e=>{"use strict";e.exports=r},640:e=>{"use strict";e.exports=s},221:e=>{"use strict";e.exports=o},686:e=>{"use strict";e.exports=n},244:e=>{"use strict";e.exports=a},321:e=>{"use strict";e.exports=l}},t={};function u(a){var n=t[a];if(void 0!==n)return n.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,u),l.exports}u.d=(e,t)=>{for(var a in t)u.o(t,a)&&!u.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var p={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(p),u.d(p,{__set_webpack_public_path__:()=>v,default:()=>g});var e=u(244),t=u(686),a=u(321),n=u(160),l=u(958),r=u(221),i=(u(640),u(750)),o=u(620),s=u(89);const c={_widgetLabel:"NDVI Analysis",pleaseSelectMap:"Please select a map",mapConnected:"Map connected",serviceUrl:"Image Service URL",rasterAnalysis:"Raster Analysis",dataset:"Dataset",rasterIndices:"Raster Indices",changeDetection:"Change Detection",comingSoon:"Coming Soon",selectIndex:"Select Index",selectParams:"Select Parameters",selectDate:"Select Date",selectDateBefore:"Before Date",selectDateAfter:"After Date",next:"Next",back:"Back",runAnalysis:"Run Analysis",running:"Processing...",calculating:"Calculating stats...",analysisCompleted:"Analysis completed!",analysisFailed:"Analysis failed",clearResults:"Clear results",newAnalysis:"New Analysis",noServiceUrl:"No Image Service URL configured",analysisScope:"Analysis Scope",modeFeature:"Clicked Feature",modeQuery:"Select by Attribute",selectLayer:"Select layer",selectField:"Select field",selectValue:"Select value",queryFound:"features found",noFeatureLayers:"No feature layers in map",ndviStats:"NDVI Statistics",changeStats:"Change Statistics",min:"Min",max:"Max",mean:"Mean",stdDev:"Std Dev",increase:"Vegetation Increase",decrease:"Vegetation Decrease",noChange:"No Significant Change",area:"Area",year:"Year",month:"Month",january:"January"};var d=function(e,t,a,n){return new(a||(a=Promise))((function(l,r){function i(e){try{s(n.next(e))}catch(e){r(e)}}function o(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,o)}s((n=n.apply(e,t||[])).next())}))};const m=[[255,0,0],[255,127,0],[255,255,0],[127,255,0],[0,180,0]];function f(e){const t=Math.max(0,Math.min(1,e))*(m.length-1),a=Math.floor(t),n=Math.min(m.length-1,a+1),l=t-a,r=m[a],i=m[n];return[Math.round(r[0]+l*(i[0]-r[0])),Math.round(r[1]+l*(i[1]-r[1])),Math.round(r[2]+l*(i[2]-r[2]))]}const y=[{id:"NDVI",label:"Vegetation (NDVI)",emoji:"\u{1f33f}",group:"Vegetation",legendLabels:["Healthy Vegetation","Bare / No Vegetation"],bands:["B04","B08","dataMask"],wmsLayer:"VEGETATION_INDEX",formula:"(s.B08-s.B04)/(s.B08+s.B04)",ramp:[[-.2,[215,25,28]],[.1,[253,174,97]],[.3,[255,255,191]],[.5,[166,217,106]],[.9,[26,150,65]]]},{id:"EVI",label:"Enhanced Veg. (EVI)",emoji:"\u{1f331}",group:"Vegetation",legendLabels:["Dense Vegetation","No Vegetation"],bands:["B02","B04","B08","dataMask"],wmsLayer:"VEGETATION_INDEX",formula:"2.5*(s.B08-s.B04)/(s.B08+6.0*s.B04-7.5*s.B02+1.0)",ramp:[[-.5,[12,12,12]],[-.2,[191,191,191]],[-.1,[219,219,219]],[0,[234,234,234]],[.025,[255,249,204]],[.05,[237,232,181]],[.075,[221,216,155]],[.1,[204,198,130]],[.125,[188,183,107]],[.15,[175,193,96]],[.175,[163,204,89]],[.2,[145,191,81]],[.25,[127,178,71]],[.3,[112,163,63]],[.35,[96,150,53]],[.4,[79,137,45]],[.45,[63,124,35]],[.5,[48,109,28]],[.55,[33,96,17]],[.6,[15,84,10]],[1,[0,68,0]]]},{id:"SAVI",label:"Soil-Adj. Veg. (SAVI)",emoji:"\u{1f3dc}\ufe0f",group:"Vegetation",legendLabels:["Dense Vegetation","Bare Soil"],bands:["B04","B08","dataMask"],wmsLayer:"VEGETATION_INDEX",formula:"1.5*(s.B08-s.B04)/(s.B08+s.B04+0.5)",ramp:[[-1,[12,12,12]],[-.5,[191,191,191]],[0,[234,234,234]],[.025,[255,250,204]],[.05,[255,254,250]],[.075,[188,183,107]],[.1,[204,199,130]],[.125,[189,184,107]],[.175,[163,204,89]],[.2,[145,191,81]],[.25,[129,179,71]],[.4,[129,179,71]],[1,[0,69,0]]]},{id:"NDWI",label:"Water (NDWI)",emoji:"\u{1f30a}",group:"Water",legendLabels:["Water Body","Dry Land"],bands:["B03","B08","dataMask"],wmsLayer:"VEGETATION_INDEX",formula:"(s.B03-s.B08)/(s.B03+s.B08)",ramp:[[-1,[0,128,0]],[-.5,[0,180,0]],[0,[255,255,255]],[.2,[0,100,200]],[.5,[0,0,204]],[1,[0,0,128]]]},{id:"NDMI",label:"Moisture (NDMI)",emoji:"\u{1f4a7}",group:"Moisture",legendLabels:["High Moisture","Low Moisture / Dry"],bands:["B8A","B11","dataMask"],wmsLayer:"MOISTURE_INDEX",formula:"(s.B8A-s.B11)/(s.B8A+s.B11)",ramp:[[-.8,[128,0,0]],[-.24,[255,0,0]],[-.032,[255,255,0]],[.032,[0,255,255]],[.24,[0,0,255]],[.8,[0,0,128]]]},{id:"NBR",label:"Burn Ratio (NBR)",emoji:"\u{1f525}",group:"Fire",legendLabels:["Unburned / Healthy","Severely Burned"],bands:["B08","B12","dataMask"],wmsLayer:"VEGETATION_INDEX",formula:"(s.B08-s.B12)/(s.B08+s.B12)",ramp:[[-1,[128,0,0]],[-.5,[255,0,0]],[-.2,[255,128,0]],[0,[255,255,0]],[.1,[200,230,100]],[.2,[127,200,80]],[.4,[0,150,0]],[1,[0,69,0]]]},{id:"TRUE_COLOR",label:"True Color",emoji:"\u{1f4f7}",group:"Imagery",bands:["B04","B03","B02","dataMask"],wmsLayer:"TRUE_COLOR",formula:"",ramp:[],forChange:!0}],g=m=>{var u;const[p,g]=e.React.useState(null),[v,R]=e.React.useState(0),[h,x]=e.React.useState("INDICES"),[E,S]=e.React.useState("NDVI"),[w,b]=e.React.useState("NDVI"),[N,C]=e.React.useState({year:"2024",month:"1"}),[B,I]=e.React.useState({year:"2023",month:"1"}),[k,M]=e.React.useState({year:"2024",month:"1"}),[A,D]=e.React.useState("IDLE"),[L,V]=e.React.useState(null),[O,T]=e.React.useState(null),[z,j]=e.React.useState(null),[U,W]=e.React.useState(null),[F,P]=e.React.useState(!1),[_,G]=e.React.useState(null),[$,q]=e.React.useState(null),[H,J]=e.React.useState({min:-.1,max:.6}),[X,Q]=e.React.useState("feature"),[Y,K]=e.React.useState(null),[Z,ee]=e.React.useState([]),[te,ae]=e.React.useState(""),[ne,le]=e.React.useState([]),[re,ie]=e.React.useState(""),[oe,se]=e.React.useState(""),[ce,de]=e.React.useState([]),[me,ue]=e.React.useState({}),[pe,fe]=e.React.useState(!1),[ye,ge]=e.React.useState({}),ve=e.React.useRef({min:1/0,max:-1/0,sum:0,sumSq:0,count:0,histogram:new Uint32Array(1001)}),Re=e.React.useCallback((e=>{if(!e||!e.pixelBlock)return;const t=e.pixelBlock,a=t.pixels[0],n=t.width*t.height,l=new Uint8Array(n),r=new Uint8Array(n),i=new Uint8Array(n),o=new Uint8Array(n),s=H.min,c=1/(H.max-s||1),d=ve.current;for(let e=0;e<n;e++){if(t.mask&&!t.mask[e]){o[e]=0;continue}const n=a[e];n<d.min&&(d.min=n),n>d.max&&(d.max=n),d.sum+=n,d.sumSq+=n*n,d.count++;const m=Math.floor(500*(n+1));m>=0&&m<=1e3&&d.histogram[m]++;let u=(n-s)*c;u<0&&(u=0),u>1&&(u=1);const[p,y,g]=f(u);l[e]=p,r[e]=y,i[e]=g,o[e]=255}t.pixels=[l,r,i,o],t.pixelType="u8",t.statistics=null}),[H]);e.React.useEffect((()=>{L&&L.redraw&&(L.pixelFilter=Re,L.redraw()),O&&O.redraw&&(O.pixelFilter=Re,O.redraw())}),[Re,L,O]);const he=e=>{const t=e.year,a=String(e.month).padStart(2,"0");return`${t}-${a}-01/${t}-${a}-${new Date(Number(t),Number(e.month),0).getDate()}`},xe=()=>d(void 0,void 0,void 0,(function*(){Ee(),D("RUNNING"),R(4),G(null),q(null),K(null),J({min:-.1,max:.6}),ve.current={min:1/0,max:-1/0,sum:0,sumSq:0,count:0,histogram:new Uint32Array(1001)};try{let e=p.view.extent.clone();if("feature"===X){const t=p.view.popup;t&&t.selectedFeature&&t.selectedFeature.geometry&&(e=t.selectedFeature.geometry)}if("query"===X){const t=(()=>{var e;return null===(e=Z.find((e=>e.id===te)))||void 0===e?void 0:e.layer})();if(t&&re&&oe){const a=t.createQuery();let n=!1;if(t.fields){const e=t.fields.find((e=>e.name===re));e&&["integer","small-integer","double","single","long","oid"].includes(e.type)&&(n=!0)}a.where=n?`${re} = ${oe}`:`${re} = '${oe.replace(/'/g,"''")}'`,a.returnGeometry=!0;const r=yield t.queryFeatures(a);if(r.features.length>0){const t=r.features.map((e=>e.geometry)).filter((e=>e));e=1===t.length?t[0]:l.union(t),K(r.features.length)}}}const t=(()=>{var e;return(null===(e=m.config)||void 0===e?void 0:e.sentinelWmsUrl)||"https://sh.dataspace.copernicus.eu/ogc/wms/d3dc6d6b-219c-48c6-8824-075249d1a64d"})(),a=y.find((e=>e.id===E))||y[0],c=(e=>{if("TRUE_COLOR"===e.id)return btoa('//VERSION=3\nfunction setup(){return{input:["B04","B03","B02","dataMask"],output:{bands:4}}}\nfunction evaluatePixel(s){return[3.5*s.B04,3.5*s.B03,3.5*s.B02,s.dataMask]}');const t=e.bands.map((e=>`"${e}"`)).join(","),a=JSON.stringify(e.ramp);return btoa(`//VERSION=3\nfunction setup(){return{input:[${t}],output:{bands:4}}}\nconst R=${a};\nfunction evaluatePixel(s){let n=${e.formula};for(let i=0;i<R.length-1;i++){if(n<R[i+1][0]){let t=Math.max(0,Math.min(1,(n-R[i][0])/(R[i+1][0]-R[i][0])));return[(R[i][1][0]*(1-t)+R[i+1][1][0]*t)/255,(R[i][1][1]*(1-t)+R[i+1][1][1]*t)/255,(R[i][1][2]*(1-t)+R[i+1][1][2]*t)/255,s.dataMask]}}let c=R[R.length-1][1];return[c[0]/255,c[1]/255,c[2]/255,s.dataMask]}`)})(a);if("INDICES"===h){const l=new n.default({url:t,sublayers:[{name:a.wmsLayer}],customParameters:{TIME:he(N),EVALSCRIPT:c,MAXCC:5,priority:"leastCC"},imageMaxWidth:1024,imageMaxHeight:1024,popupEnabled:!1});let r=null;if(e){const t=new o.default;t.add(new s.default({geometry:e,symbol:{type:"simple-fill",color:[255,255,255,1],outline:{width:0}}})),t.blendMode="destination-in";const a=new i.default({layers:[l,t]});p.view.map.add(a),V(a),p.view.goTo(e.extent.expand(1.3)),r=a}else p.view.map.add(l),V(l),r=l;P(!0),D("SUCCESS"),setTimeout((()=>{if(!p.view.updating)return void P(!1);const e=p.view.watch("updating",(t=>{t||(P(!1),e.remove())}))}),200)}else{const l=new n.default({url:t,sublayers:[{name:a.wmsLayer}],customParameters:{TIME:he(B),EVALSCRIPT:c,MAXCC:5,priority:"leastCC"},imageMaxWidth:1024,imageMaxHeight:1024,popupEnabled:!1}),d=new n.default({url:t,sublayers:[{name:a.wmsLayer}],customParameters:{TIME:he(k),EVALSCRIPT:c,MAXCC:5,priority:"leastCC"},imageMaxWidth:1024,imageMaxHeight:1024,popupEnabled:!1});let m=null;if(e){const t=new o.default;t.add(new s.default({geometry:e,symbol:{type:"simple-fill",color:[255,255,255,1],outline:{width:0}}})),t.blendMode="destination-in";const a=new o.default;a.add(new s.default({geometry:e,symbol:{type:"simple-fill",color:[255,255,255,1],outline:{width:0}}})),a.blendMode="destination-in";const n=new i.default({layers:[l,t]}),r=new i.default({layers:[d,a]});p.view.map.add(n),p.view.map.add(r),T(n),V(r),m=r}else p.view.map.add(l),p.view.map.add(d),T(l),V(d),m=d;const u=e?[p.view.map.layers.items[p.view.map.layers.length-2]]:[l],f=e?[p.view.map.layers.items[p.view.map.layers.length-1]]:[d],y=new r.default({view:p.view,leadingLayers:u,trailingLayers:f,position:50,direction:"horizontal"});p.view.ui.add(y),j(y),e&&p.view.goTo(e.extent.expand(1.3)),P(!0),D("SUCCESS"),setTimeout((()=>{if(!p.view.updating)return void P(!1);const e=p.view.watch("updating",(t=>{t||(P(!1),e.remove())}))}),200)}}catch(e){console.error(e),D("ERROR")}})),Ee=()=>{var e,t;L&&p.view.map.remove(L),O&&p.view.map.remove(O),z&&(z.destroy(),j(null)),U&&(null===(t=null===(e=null==p?void 0:p.view)||void 0===e?void 0:e.map)||void 0===t||t.remove(U),W(null)),V(null),T(null),P(!1)},Se=e=>m.intl.formatMessage({id:e,defaultMessage:c[e]||e}),we="feature"===X||"query"===X&&re&&oe;e.React.useEffect((()=>{try{const e=document.querySelector(`div[data-widgetid="${m.widgetId}"]`);if(e){const t=e.closest(".widget-renderer");t&&(t.style.setProperty("background-color","transparent","important"),t.style.setProperty("box-shadow","none","important"))}}catch(e){console.error("Could not clear widget background",e)}}),[m.widgetId]);const be=({title:t,onBack:n,onClose:l})=>e.React.createElement("div",{className:"d-flex align-items-center mb-3 pb-2",style:{borderBottom:"1px solid #e0e0e0"}},n&&e.React.createElement(a.Button,{type:"tertiary",icon:!0,size:"sm",onClick:n,style:{marginRight:"4px",fontSize:"14px"}},"\u2190"),e.React.createElement("h6",{className:"m-0 flex-grow-1",style:{fontSize:"12px",fontWeight:600,color:"#1976d2"}},t),e.React.createElement(a.Button,{type:"tertiary",icon:!0,size:"sm",onClick:l,title:Se("exit"),style:{fontSize:"12px"}},"\u2715")),Ne=()=>{Ee(),R(0),D("IDLE")},Ce="CHANGE"===h?y:y.filter((e=>"TRUE_COLOR"!==e.id)),Be=Array.from({length:(new Date).getFullYear()-2015+1},((e,t)=>String(2015+t))),Ie=[{v:"1",l:"Jan"},{v:"2",l:"Feb"},{v:"3",l:"Mar"},{v:"4",l:"Apr"},{v:"5",l:"May"},{v:"6",l:"Jun"},{v:"7",l:"Jul"},{v:"8",l:"Aug"},{v:"9",l:"Sep"},{v:"10",l:"Oct"},{v:"11",l:"Nov"},{v:"12",l:"Dec"}],ke=({value:t,onChange:n})=>{const l=new Date,r=String(l.getFullYear()),i=l.getMonth()+1,o=t.year===r?Ie.filter((e=>Number(e.v)<=i)):Ie;return e.React.createElement("div",{className:"d-flex gap-2"},e.React.createElement(a.Select,{size:"sm",value:t.year,onChange:e=>(e=>{let a=t.month;e===r&&Number(a)>i&&(a=String(i)),n({year:e,month:a})})(e.target.value)},Be.map((t=>e.React.createElement(a.Option,{key:t,value:t},t)))),e.React.createElement(a.Select,{size:"sm",value:t.month,onChange:e=>n(Object.assign(Object.assign({},t),{month:e.target.value}))},o.map((t=>e.React.createElement(a.Option,{key:t.v,value:t.v},t.l)))))};return e.React.createElement("div",{className:"widget-demo jimu-widget p-2",style:{display:"flex",flexDirection:"column",justifyContent:"flex-end",height:"100%",minHeight:"100%",overflowY:"auto",background:"transparent",color:"#000",width:"100%",maxWidth:"380px",margin:"0 auto"}},e.React.createElement("style",null,"\n    @keyframes slideUp {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n    .animate-slide-up {\n        animation: slideUp 0.2s ease-out forwards;\n    }\n    @keyframes spin {\n        to { transform: rotate(360deg); }\n    }\n    .analysis-spinner {\n        display: inline-block;\n        width: 28px; height: 28px;\n        border: 3px solid #e0e0e0;\n        border-top-color: #1976d2;\n        border-radius: 50%;\n        animation: spin 0.7s linear infinite;\n    }\n  "),e.React.createElement(t.JimuMapViewComponent,{useMapWidgetId:null===(u=m.useMapWidgetIds)||void 0===u?void 0:u[0],onActiveViewChange:e=>{if(!e)return;g(e);const t=[];e.view.map.allLayers.forEach((e=>{"feature"===e.type&&e.title&&t.push({id:e.id,title:e.title,layer:e})})),ee(t)}}),!p&&e.React.createElement("div",{className:"small",style:{color:"#e65100"}},Se("pleaseSelectMap")),e.React.createElement("div",{style:{width:"100%",paddingBottom:"10px"}},0===v&&e.React.createElement("div",{className:"animate-slide-up"},e.React.createElement(a.Button,{type:"primary",className:"w-100 shadow-sm",onClick:()=>R(1),style:{padding:"10px 16px",fontSize:"13px",fontWeight:600}},Se("rasterAnalysis"))),1===v&&e.React.createElement("div",{className:"p-3 rounded shadow-sm animate-slide-up",style:{background:"#fff",border:"1px solid #ddd"}},e.React.createElement(be,{title:Se("analysisScope"),onClose:Ne}),e.React.createElement("div",{className:"mb-1 px-1",style:{fontSize:"9px",color:"#1976d2"}},"\u{1f6f0}\ufe0f Sentinel-2 \xb7 10m \xb7 All dates since 2015"),e.React.createElement("label",{className:"d-block mb-1 mt-2",style:{fontSize:"10px",fontWeight:600,textTransform:"uppercase",color:"#888"}},"Analysis Type"),e.React.createElement("div",{className:"d-flex gap-2 mb-3",style:{flexWrap:"wrap"}},e.React.createElement(a.Button,{type:"INDICES"===h?"primary":"default",size:"sm",className:"flex-grow-1",onClick:()=>{x("INDICES")}},Se("rasterIndices")),e.React.createElement(a.Button,{type:"CHANGE"===h?"primary":"default",size:"sm",className:"flex-grow-1",onClick:()=>{x("CHANGE")}},Se("changeDetection"))),e.React.createElement("div",{className:"mb-2"},e.React.createElement("label",{className:"d-block mb-2",style:{fontSize:"10px",fontWeight:600,textTransform:"uppercase",color:"#888"}},"INDICES"===h?"Select Index":"Compare Using"),Object.entries(Ce.reduce(((e,t)=>((e[t.group]=e[t.group]||[]).push(t),e)),{})).map((([t,n],l,r)=>e.React.createElement("div",{key:t,style:{paddingBottom:"8px",marginBottom:l<r.length-1?"8px":"0",borderBottom:l<r.length-1?"1px solid #e8e8e8":"none"}},e.React.createElement("div",{style:{fontSize:"9px",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.8px",color:"#888",marginBottom:"5px"}},t),e.React.createElement("div",{className:"d-flex gap-1",style:{flexWrap:"wrap"}},n.map((t=>e.React.createElement(a.Button,{key:t.id,type:E===t.id?"primary":"default",size:"sm",onClick:()=>{S(t.id),R(2)},style:{flex:"1 1 0",fontSize:"11px",padding:"5px 4px",fontWeight:500,minWidth:0}},t.emoji," ",t.id))))))))),2===v&&e.React.createElement("div",{className:"p-3 rounded shadow-sm animate-slide-up",style:{background:"#fff",border:"1px solid #ddd"}},e.React.createElement(be,{title:"INDICES"===h?`${w} \u2014 ${Se("dataset")}`:Se("changeDetection"),onBack:()=>R(1),onClose:Ne}),e.React.createElement("div",{className:"d-flex flex-column gap-2"},"INDICES"===h&&e.React.createElement(ke,{value:N,onChange:C}),"CHANGE"===h&&e.React.createElement("div",{className:"d-flex flex-column gap-2"},e.React.createElement("div",null,e.React.createElement("div",{className:"small mb-1",style:{fontSize:"10px",color:"#888"}},"Before (Old)"),e.React.createElement(ke,{value:B,onChange:I})),e.React.createElement("div",null,e.React.createElement("div",{className:"small mb-1",style:{fontSize:"10px",color:"#888"}},"After (New)"),e.React.createElement(ke,{value:k,onChange:M}))),e.React.createElement(a.Button,{type:"primary",size:"sm",className:"w-100 mt-1",onClick:()=>R(3)},Se("next")," \u2192"))),3===v&&e.React.createElement("div",{className:"p-3 rounded shadow-sm animate-slide-up",style:{background:"#fff",border:"1px solid #ddd",position:"relative",zIndex:1e4}},e.React.createElement(be,{title:Se("selectParams"),onBack:()=>R(2),onClose:Ne}),e.React.createElement("div",{className:"d-flex flex-column gap-2 mb-3"},e.React.createElement("label",{className:"d-flex align-items-center",style:{cursor:"pointer"}},e.React.createElement("input",{type:"radio",name:"maskMode",checked:"feature"===X,onChange:()=>Q("feature"),className:"mr-2"}),Se("modeFeature")),e.React.createElement("label",{className:"d-flex align-items-center",style:{cursor:"pointer"}},e.React.createElement("input",{type:"radio",name:"maskMode",checked:"query"===X,onChange:()=>Q("query"),className:"mr-2"}),Se("modeQuery"))),"query"===X&&e.React.createElement("div",{className:"d-flex flex-column gap-1 mb-3"},e.React.createElement("select",{className:"form-control form-control-sm",style:{fontSize:"12px",padding:"4px 8px",backgroundColor:"#fff",color:"#000",border:"1px solid #ccc"},value:te,onChange:e=>{return t=e.target.value,d(void 0,void 0,void 0,(function*(){ae(t),le([]),ie(""),se(""),de([]);const e=Z.find((e=>e.id===t));if(!e)return;const a=e.layer;if(!a.loaded)try{yield a.load()}catch(e){}const n={};if(a.fields){a.fields.forEach((e=>n[e.name]=e.alias||e.name)),ge(n);const e=a.fields.filter((e=>"oid"!==e.type&&"geometry"!==e.type&&!e.name.toLowerCase().includes("shape")&&!e.name.toLowerCase().includes("globalid")));le(e)}}));var t}},e.React.createElement("option",{value:""},Se("selectLayer")),Z.map((t=>e.React.createElement("option",{key:t.id,value:t.id},t.title)))),ne.length>0&&e.React.createElement("select",{className:"form-control form-control-sm",style:{fontSize:"12px",padding:"4px 8px",backgroundColor:"#fff",color:"#000",border:"1px solid #ccc"},value:re,onChange:e=>{return t=e.target.value,d(void 0,void 0,void 0,(function*(){var e,a,n,l,r,i;ie(t),se(""),de([]),ue({});const o=Z.find((e=>e.id===te));if(o){fe(!0);try{const s={},c=o.layer,d=e=>e&&("coded-value"===e.type||"codedValue"===e.type),m=e=>{(e.codedValues||[]).forEach((e=>{s[String(e.code)]=e.name}))};c.typeIdField===t&&(null===(e=c.types)||void 0===e?void 0:e.length)&&c.types.forEach((e=>{s[String(e.id)]=e.name}));const u=null===(a=c.fields)||void 0===a?void 0:a.find((e=>e.name===t));if(0===Object.keys(s).length&&(null==u?void 0:u.domain)&&d(u.domain)&&m(u.domain),0===Object.keys(s).length&&"function"==typeof c.getFieldDomain)try{const e=c.getFieldDomain(t);d(e)&&m(e)}catch(e){}if(0===Object.keys(s).length&&(null===(n=c.types)||void 0===n?void 0:n.length)&&c.types.forEach((e=>{var a;const n=null===(a=e.domains)||void 0===a?void 0:a[t];d(n)&&m(n)})),0===Object.keys(s).length&&(null===(l=c.sourceJSON)||void 0===l?void 0:l.fields)){const e=c.sourceJSON.fields.find((e=>e.name===t));!(null==e?void 0:e.domain)||"codedValue"!==e.domain.type&&"coded-value"!==e.domain.type||(e.domain.codedValues||[]).forEach((e=>{s[String(e.code)]=e.name}))}0===Object.keys(s).length&&(null===(i=null===(r=c.sourceJSON)||void 0===r?void 0:r.types)||void 0===i?void 0:i.length)&&c.sourceJSON.types.forEach((e=>{var a;const n=null===(a=e.domains)||void 0===a?void 0:a[t];!n||"codedValue"!==n.type&&"coded-value"!==n.type||(n.codedValues||[]).forEach((e=>{s[String(e.code)]=e.name}))})),ue(s),console.log("Coded value map for",t,":",s);const p=o.layer.createQuery();p.where="1=1",p.outFields=[t],p.returnDistinctValues=!0,p.returnGeometry=!1,p.orderByFields=[t];const f=(yield o.layer.queryFeatures(p)).features.map((e=>e.attributes[t])).filter((e=>null!=e)).map((e=>String(e))),y=[...new Set(f)];de(y),y.length>0&&se(y[0])}catch(e){console.error(e)}finally{fe(!1)}}}));var t}},e.React.createElement("option",{value:""},Se("selectField")),ne.map((t=>e.React.createElement("option",{key:t.name,value:t.name},ye[t.name]||t.name)))),ce.length>0&&e.React.createElement("select",{className:"form-control form-control-sm",style:{fontSize:"12px",padding:"4px 8px",backgroundColor:"#fff",color:"#000",border:"1px solid #ccc"},value:oe,onChange:e=>se(e.target.value)},e.React.createElement("option",{value:""},Se("selectValue")),ce.map((t=>e.React.createElement("option",{key:t,value:t},me[t]||t))))),e.React.createElement(a.Button,{type:"primary",size:"sm",className:"w-100",onClick:()=>xe(),disabled:!we},Se("runAnalysis"))),4===v&&e.React.createElement("div",{className:"p-3 rounded shadow-sm animate-slide-up",style:{background:"#f0f8ff",border:"1px solid #ddd"}},e.React.createElement(be,{title:Se("analysisCompleted"),onBack:()=>{Ee(),G(null),q(null),K(null),D("IDLE"),R(3)},onClose:Ne}),e.React.createElement("div",{className:"text-center"},("RUNNING"===A||"CALCULATING"===A)&&e.React.createElement("div",{className:"py-4 d-flex flex-column align-items-center gap-2"},e.React.createElement("div",{className:"analysis-spinner"}),e.React.createElement("div",{style:{fontSize:"11px",color:"#666"}},Se("CALCULATING"===A?"calculating":"running"))),"SUCCESS"===A&&e.React.createElement("div",{className:"w-100"},"INDICES"===h&&e.React.createElement("div",{className:"py-2"},e.React.createElement("div",{className:"text-center mb-2"},e.React.createElement("div",{className:"d-inline-block p-2 px-3 rounded",style:{background:"#e3f2fd",fontSize:"11px"}},(y.find((e=>e.id===E))||y[0]).emoji," ",e.React.createElement("strong",null,"Sentinel-2 ",E),e.React.createElement("div",{style:{fontSize:"9px",color:"#666",marginTop:"2px"}},N.year,"-",String(N.month).padStart(2,"0")," \xb7 10m resolution")),F?e.React.createElement("div",{className:"d-flex align-items-center justify-content-center gap-1 mt-2",style:{fontSize:"10px",color:"#1976d2"}},e.React.createElement("div",{className:"analysis-spinner",style:{width:"14px",height:"14px",borderWidth:"2px"}}),"Loading imagery\u2026"):e.React.createElement("div",{className:"mt-2",style:{fontSize:"10px",color:"#2e7d32",fontWeight:600}},"\u2705 Analysis Result Complete"))),"CHANGE"===h&&e.React.createElement("div",{className:"py-2 text-center"},e.React.createElement("div",{className:"p-2 rounded",style:{background:"#e3f2fd",fontSize:"11px"}},(y.find((e=>e.id===E))||y[0]).emoji," ",e.React.createElement("strong",null,"Sentinel-2 ",E," Change"),e.React.createElement("div",{style:{fontSize:"9px",color:"#666",marginTop:"2px"}},B.year,"-",String(B.month).padStart(2,"0")," \u2192 ",k.year,"-",String(k.month).padStart(2,"0"))),F?e.React.createElement("div",{className:"d-flex align-items-center justify-content-center gap-1 mt-2",style:{fontSize:"10px",color:"#1976d2"}},e.React.createElement("div",{className:"analysis-spinner",style:{width:"14px",height:"14px",borderWidth:"2px"}}),"Loading imagery\u2026"):e.React.createElement("div",{className:"mt-2",style:{fontSize:"10px",color:"#2e7d32",fontWeight:600}},"\u2705 Analysis Result Complete"),e.React.createElement("div",{className:"mt-2 text-center",style:{fontSize:"9px",color:"#888"}},"\u2194 Swipe on map to compare visually")))))))};function v(e){u.p=e}})(),p})())}}}));